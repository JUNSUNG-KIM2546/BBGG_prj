<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fake">
	<sql id="search">
		SELECT tbl_fake.* FROM tbl_fake 
		
		<where>
			<if test="search == 1">
				tbl_fake.item_no = #{keyword}
			</if>
			
			<if test="search == 2">
				tbl_partner.comp_name LIKE CONCAT(CONCAT('%', #{keyword}), '%')
			</if>
			
			<if test="search == 3">
				tbl_fake.user_no LIKE CONCAT(CONCAT('%', #{keyword}), '%')
			</if>
			
			<if test="search == 4">
				tbl_fake.use_at LIKE CONCAT(CONCAT('%', #{keyword}), '%')
			</if>
		</where>
		
		ORDER BY tbl_fake.fake_no
	</sql>

	<select id="selectList" resultType="fakeVO">
		SELECT sup.*
		FROM (SELECT sub.*, ROW_NUMBER() OVER() as rnum 
			  FROM (SELECT tf.*, tp.comp_name 
					FROM tbl_fake AS tf, tbl_item AS ti, tbl_partner AS tp
					WHERE tf.item_no  = ti.item_no 
						AND ti.partner_no = tp.partner_no 
					ORDER BY tf.fake_no) AS sub) AS sup
		        
		<if test="perPage != 0">
			<![CDATA[
			WHERE rnum > ((#{page}-1)*#{perPage}) AND rnum <= (#{page}*#{perPage})
			]]>
		</if>
	</select>
	
	<select id="total" resultType="Integer">
		SELECT COUNT(*) FROM (<include refid="search"></include>) as sub
	</select>

	<insert id="insert">
		INSERT INTO tbl_fake (item_no, 
								user_no, 
								fake_check1, 
								fake_check2, 
								fake_check3, 
								fake_content, 
								use_at, 
								agree_at,
								file_name)
		VALUES (#{itemNo}, 
				1, 
				#{fakeCheck1}, 
				#{fakeCheck2}, 
				#{fakeCheck3}, 
				#{fakeContent}, 
				"Y", 
				#{agreeAt},
				#{uniqueName}
				)
	</insert>
	
	<update id=""></update>

</mapper>