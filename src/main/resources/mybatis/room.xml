<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="room">

	<!-- <resultMap type="kr.ac.kopo.room.web.RoomVO" id="room">
		<result property="roomNo" 			column="room_no" />
		<result property="agencyNo" 		column="agency_no" />
		<result property="leaseNo" 			column="lease_no" />
		<result property="monthNo" 			column="month_no" />
		<result property="roomType" 		column="room_type" />
		<result property="address" 			column="address" />
		<result property="dong" 			column="dong" />
		<result property="ho" 				column="ho" />
		<result property="moveInAt" 		column="move_in_at" />
		<result property="moveInDate" 		column="move_in_date" />
		<result property="roomSize" 		column="room_size" />
		<result property="buildingFloor" 	column="building_floor" />
		<result property="roomFloor" 		column="room_floor" />
		<result property="roomCount" 		column="room_count" />
		<result property="bathAt" 			column="bath_at" />
		<result property="elevatorAt" 		column="elevator_at" />
		<result property="parkingAt" 		column="parking_at" />
		<result property="manageFeeAt" 		column="manage_fee_at" />
		<result property="manageFee" 		column="manage_fee" />
		<result property="memoShort" 		column="memo_short" />
		<result property="memoDetail" 		column="memo_detail" />
		<result property="registDate" 		column="regist_date" />
		<result property="updateDate" 		column="update_date" />
		<result property="useAt" 			column="use_at" />
		<result property="lat" 				column="lat" />
		<result property="lng" 				column="lng" />
	</resultMap> -->
	
	<select id="roomList" resultType="RoomVO">
		SELECT *	FROM tbl_room WHERE address LIKE CONCAT(CONCAT('%', #{address}), '%')
		<!-- <where>
			<if test="search != #{keyword}">		오라클은 CONCAT을 2개값만 허용해서 이중으로 사용 (myDB는 3개)
				address LIKE CONCAT(CONCAT('%', #{keyword}), '%')	
			</if>
			
			<if test="search != #{keyword}">
				lat LIKE CONCAT(CONCAT('%', #{keyword}), '%')
			</if>
			
			<if test="search != #{keyword}">
				lng LIKE CONCAT(CONCAT('%', #{keyword}), '%')
			</if>
		</where> -->
		<!-- WHERE
		<if test="searchWrd != null and searchWrd !=''">
		    (fctry_rdnmadr LIKE CONCAT('%', #{searchWrd},'%') or  
		    fctry_cmpnm LIKE CONCAT('%', #{searchWrd},'%'))
		</if> -->
	</select>
	
	<select id="roomSelect" resultType="RoomVO">
		SELECT 
		
		<choose>
	        <when test="leaseOrMonth == 'lease'">
	            (SELECT lease_price FROM tbl_lease  WHERE tbl_lease.room_no = tbl_room.room_no) AS "전세가격",
	        </when>
	        <otherwise>
	            (SELECT deposlt_fee FROM tbl_month  WHERE tbl_month.room_no = tbl_room.room_no) AS "보증금",
	            (SELECT month_price FROM tbl_month  WHERE tbl_month.room_no = tbl_room.room_no) AS "월세가격",
	        </otherwise>
	    </choose>
		tbl_room.*
		FROM tbl_room
		WHERE room_No = #{roomNo}
	
	</select>
	
	<insert id="roomAdd">
	    INSERT INTO tbl_room
	    (
	    partner_no,
	    lease_or_month,
	    room_type,
	    address, 
	    address2,
	    dong,
	    ho,
	    move_in_at, 
	    move_in_date,
	    room_size, 
	    building_floor,
	    room_floor,
	    room_count,
	    bath_at,
	    elevator_at,
	    parking_at,
	    manage_fee_at,
	    manage_fee, 
	    memo_short,
	    memo_detail,
	    regist_date,
	    update_date,
	    lat,
	    lng,
	    use_at
	    )
	    VALUES 
	    (
	    1,
	    #{leaseOrMonth},
	    #{roomType},
	    #{address},
	    #{address2},
	    #{dong},
	    #{ho},
	    #{moveInAt},
	    <choose>
	        <when test="moveInDate == null">
	            NOW(),
	        </when>
	        <otherwise>
	            #{moveInDate},
	        </otherwise>
	    </choose>
	    
	    #{roomSize},
	    #{buildingFloor},
	    #{roomFloor},
	    #{roomCount},
	    #{bathAt},
	    #{elevatorAt},
	    #{parkingAt},
	    #{manageFeeAt},
	    
	    <choose>
	        <when test="manageFee != null">
	            #{manageFee},
	        </when>
	        <otherwise>
	            NULL,
	        </otherwise>
	    </choose>
	    
	    #{memoShort},
	    #{memoDetail},
	    NOW(),
	    NOW(),
	    #{lat},
	    #{lng},
	    'y'
	    )
	    
	    <selectKey keyProperty="roomNo" resultType="Long" order="AFTER">
	    	SELECT LAST_INSERT_ID()
	    </selectKey>
	</insert>
	
	<insert id="leaseAdd">
	    INSERT INTO tbl_lease(lease_price, room_no)
		VALUES (#{leasePrice}, #{roomNo})
	</insert>
	
	<insert id="monthAdd">
		INSERT INTO tbl_month(deposlt_fee, month_price, room_no)
		VALUES (#{deposltFee}, #{monthPrice}, #{roomNo})
	</insert>
	
</mapper>